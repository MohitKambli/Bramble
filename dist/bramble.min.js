!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Bramble=t():e.Bramble=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/js/",n(n.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);function i(e,t){a(e,{x:0,y:0},{width:e.canvas.width,height:e.canvas.height},{fill:{colour:t}})}function o(e,t,n,r){void 0===r&&(r=u),a(e,{x:t.x,y:t.y},{width:n,height:n},r)}var u={fill:{colour:"#ffffff",opacity:1},line:{width:2,colour:"#000000",opacity:1}};function a(e,t,n,r){void 0===r&&(r=u),void 0!==r.fill&&(e.fillStyle=r.fill.colour,e.fillRect(t.x,t.y,n.width,n.height)),void 0!==r.line&&(e.strokeStyle=r.line.colour,e.lineWidth=r.line.width,e.strokeRect(t.x,t.y,n.width,n.height))}var l={width:2,colour:"#000000"};function c(e,t,n,r){void 0===r&&(r=l),e.strokeStyle=r.colour,e.lineWidth=r.width,e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.stroke()}var f={fill:{colour:"#000000",opacity:1},line:{colour:"#ffffff",opacity:1,width:2}};function d(e,t,n,r){void 0===r&&(r=f),void 0!==r.fill&&(e.fillStyle=r.fill.colour),e.beginPath(),e.strokeStyle=r.line.colour,e.lineWidth=r.line.width,e.arc(t.x,t.y,n,0,2*Math.PI),e.closePath(),void 0!==r.fill&&e.fill(),e.stroke()}function s(e,t,n,r){e.drawImage(r,t.x,t.y,n.width,n.height)}function h(e,t,n,r,i,o){e.drawImage(o,r.x,r.y,i.width,i.height,t.x,t.y,n.width,n.height)}function v(e,t){var n=t.width/2,i=t.height/2;e.save(),e.translate(t.x+n,t.y+i),e.rotate(r.default.toRadians(t.rotation)),t.frames.length>1?h(e,{x:-n,y:-i},{width:t.width,height:t.height},{x:t.frames[t.frame].x,y:t.frames[t.frame].y},{width:t.frames[t.frame].width,height:t.frames[t.frame].height},t.texture):s(e,{x:-n,y:-i},{width:t.width,height:t.height},t.texture),e.restore()}function y(e,t,n,r,i){void 0===n&&(n=""),void 0===r&&(r="#000000"),void 0===i&&(i="16pt sans-serif"),e.fillStyle=r,e.font=i,e.textAlign="left",e.textBaseline="top",e.fillText(n,t.x,t.y)}function g(e,t,n,r,i,o){for(var u=1,a=2,l=4,c=8,f=16,d=32,s=64,v=128,y=function(o){for(var y=function(y){if(0===n[o][y])return"continue";var g=o>0?n[o-1][y-1]:0,p=o>0?n[o-1][y]:0,m=o>0?n[o-1][y+1]:0,x=n[o][y-1],b=n[o][y],w=n[o][y+1],O=o<n.length-1?n[o+1][y-1]:0,P=o<n.length-1?n[o+1][y]:0,j=o<n.length-1?n[o+1][y+1]:0,_=u*(b===p&&b===x&&b===g?1:0)+a*(b===p?1:0)+l*(b===p&&b===w&&b===m?1:0)+c*(b===w?1:0)+f*(b===P&&b===w&&b===j?1:0)+d*(b===P?1:0)+s*(b===P&&b===x&&b===O?1:0)+v*(b===x?1:0),S=r.filter((function(e){return e.type===n[o][y]}))[0];if(!S)return console.error("Sheet "+n[o][y]+" not found!"),{value:void 0};var M=S.tiles.filter((function(e){return e.type===_})),T=M[Math.floor(Math.random()*M.length)];T?function(e,t,n,r,i,o,u){h(e,{x:t.x+o*(r.x*u.width),y:t.y+o*(r.y*u.height)},{width:o*u.width,height:o*u.height},{x:u.width*i.x,y:u.height*i.y},{width:u.width,height:u.height},n)}(e,t,S.image,{x:y,y:o},T.position,i,T.size):console.log("Tile not defined "+_)},g=0;g<n[o].length;g++){var p=y(g);if("object"==typeof p)return p}},g=0;g<n.length;g++){var p=y(g);if("object"==typeof p)return p.value}}var p={shadowcolour:"#000000",shadowBlur:6,shadowOffsetX:4,shadowOffsetY:4};function m(e,t,n){void 0===n&&(n=p),e.save(),e.shadowColor=n.shadowcolour,e.shadowBlur=n.shadowBlur,e.shadowOffsetX=n.shadowOffsetX,e.shadowOffsetY=n.shadowOffsetY,t(),e.restore()}function x(e,t){e.save(),e.globalCompositeOperation="colour-dodge",t(),e.restore()}function b(e,t){e.save(),e.globalCompositeOperation="overlay",t(),e.restore()}function w(e,t,n){void 0===n&&(n=.25),e.save(),e.globalAlpha=n,t(),e.restore()}t.default={create:function(e){return{circle:function(t,n,r){void 0===r&&(r=f),d(e,t,n,r)},clear:function(t){i(e,t)},square:function(t,n,r){void 0===r&&(r=u),o(e,t,n,r)},rect:function(t,n,r){void 0===r&&(r=u),a(e,t,n,r)},image:function(t,n,r){s(e,t,n,r)},line:function(t,n,r){void 0===r&&(r=l),c(e,t,n,r)},sprite:function(t){v(e,t)},subImage:function(t,n,r,i,o){h(e,t,n,r,i,o)},text:function(t,n,r,i){void 0===t&&(t={x:0,y:0}),void 0===n&&(n=""),void 0===r&&(r="#000000"),void 0===i&&(i="16pt sans-serif"),y(e,t,n,r,i)},tiles:function(t,n,r,i,o){g(e,t,n,r,i)},shadow:function(t,n){void 0===n&&(n=p),m(e,t,n)},dodge:function(t){x(e,t)},overlay:function(t){b(e,t)},transparency:function(t,n){void 0===n&&(n=.25),w(e,t,n)}}},circle:d,clear:i,image:s,line:c,rect:a,sprite:v,square:o,subImage:h,text:y,tiles:g,shadow:m,dodge:x,overlay:b,transparency:w}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keyboard=t.mouse=void 0;var r=n(6);t.mouse={create:function(e){var t=r.default.create(e);return{start:function(){t.start()},update:function(){t.update()},getState:function(){return t.getState()}}}},t.keyboard={create:function(){console.log("keyboard input stub")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec2=t.sprite=t.mouse=t.keyboard=t.graphics=t.grid=t.game=t.assets=void 0;var r=n(3);Object.defineProperty(t,"assets",{enumerable:!0,get:function(){return r.default}});var i=n(4);Object.defineProperty(t,"game",{enumerable:!0,get:function(){return i.default}});var o=n(7);Object.defineProperty(t,"grid",{enumerable:!0,get:function(){return o.default}});var u=n(0);Object.defineProperty(t,"graphics",{enumerable:!0,get:function(){return u.default}});var a=n(1);Object.defineProperty(t,"keyboard",{enumerable:!0,get:function(){return a.keyboard}}),Object.defineProperty(t,"mouse",{enumerable:!0,get:function(){return a.mouse}});var l=n(8);Object.defineProperty(t,"sprite",{enumerable:!0,get:function(){return l.default}});var c=n(9);Object.defineProperty(t,"vec2",{enumerable:!0,get:function(){return c.default}})},function(e,t,n){"use strict";function r(e){return new Promise((function(t,n){var r=new XMLHttpRequest;r.addEventListener("load",(function(e){t(r.responseText)})),r.addEventListener("error",(function(e){n(e)})),r.open("GET",e),r.send()}))}function i(e){return void 0===e&&(e=[]),Promise.all(e.map((function(e){return r(e)})))}function o(e){return new Promise((function(t,n){var r=new Image;r.addEventListener("load",(function(e){t(r)})),r.addEventListener("error",(function(e){n(e)})),r.src=e}))}function u(e){return void 0===e&&(e=[]),Promise.all(e.map((function(e){return o(e)})))}function a(e){var t;return r(e).then((function(e){return o((t=JSON.parse(e)).path)})).then((function(e){return{name:t.name,type:t.type,image:e,tiles:t.tiles}}))}function l(e){return void 0===e&&(e=[]),Promise.all(e.map((function(e){return a(e)})))}Object.defineProperty(t,"__esModule",{value:!0}),t.loadAllTerrain=t.loadTerrain=t.loadAllImages=t.loadImage=t.loadAllText=t.loadString=void 0,t.loadString=r,t.loadAllText=i,t.loadImage=o,t.loadAllImages=u,t.loadTerrain=a,t.loadAllTerrain=l,t.default={loadImage:o,loadString:r,loadAllText:i,loadAllImages:u,loadTerrain:a,loadAllTerrain:l}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(1);t.default={create:function(){var e="#000000",t=null,n=null,o=document.createElement("canvas"),u=o.getContext("2d"),a=r.default.create(u);o.id="bramble-game";var l=i.mouse.create(o),c=function(){t&&t(1/60),n&&(a.clear(e),n(a)),l.update(),window.requestAnimationFrame(c)};return{setSize:function(e,t){o.width=e,o.height=t},setUpdate:function(e){t=e},setRender:function(e){n=e},setBackgroundColor:function(t){e=t},attachTo:function(e){e.appendChild(o)},disableContextMenu:function(){o.addEventListener("contextmenu",(function(e){e.preventDefault()}))},setSmoothing:function(e){void 0===e&&(e=!0),u.imageSmoothingEnabled=e},start:function(){(l=i.mouse.create(o)).start(),window.requestAnimationFrame(c)},getMouseState:function(){return l.getState()}}}}},function(e,t,n){"use strict";function r(e){return e*(Math.PI/180)}function i(e){return e*(180/Math.PI)}Object.defineProperty(t,"__esModule",{value:!0}),t.toDegrees=t.toRadians=void 0,t.toRadians=r,t.toDegrees=i,t.default={toRadians:r,toDegrees:i}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.default={create:function(e){var t=function(){return{x:0,y:0,left:n(),wheel:i(),right:n()}},n=function(){return{pressed:!1,justPressed:!1,released:!1,justReleased:!1}},i=function(){var e=n();return r(r({},e),{moved:!1,direction:"up"})},o=(t(),t()),u=function(t){var n=function(t){var n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}(t);o.x=n.x,o.y=n.y},a=function(e){switch(e.which){case 1:o.left.pressed=!0;break;case 2:o.wheel.pressed=!0;break;case 3:o.right.pressed=!0}},l=function(e){switch(e.which){case 1:o.left.pressed=!1;break;case 2:o.wheel.pressed=!1;break;case 3:o.right.pressed=!1}},c=function(e){o.wheel.moved=0!==e.deltaY,!1!==o.wheel.moved&&(o.wheel.direction=e.deltaY<0?"up":"down")};return{getState:function(){return o},start:function(){e.addEventListener("mousemove",u),e.addEventListener("mousedown",a),e.addEventListener("mouseup",l),e.addEventListener("wheel",c),o.x=e.width/2,o.y=e.height/2},update:function(){var e;o.wheel.moved=!1,e=o,Object.assign({},e)}}}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function i(e){return e.map((function(e){return e.slice()}))}Object.defineProperty(t,"__esModule",{value:!0});var o={pos:{x:0,y:0},visible:!0,divisions:4,tileWidth:8,tileHeight:8,scale:1};t.default={create:function(e,t,n){void 0===n&&(n=o),n=r(r({},o),n);var i=function(e,t,n){void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=null);for(var r=[],i=0;i<t;i++){for(var o=[],u=0;u<e;u++)o.push(n);r.push(o)}return r}(e,t,0),u={x:n.pos.x,y:n.pos.y},a=n.visible,l=n.divisions,c=n.tileWidth;return{divisions:l,pos:u,tileHeight:n.tileHeight,tiles:i,tileWidth:c,visible:a,width:e,height:t,tileSize:n.tileWidth,scale:n.scale}},fill:function(e,t,n,r){var o=i(e);return function e(t,n,r){n!==r&&o[t.y][t.x]===n&&t.x<o[t.y].length&&t.x>=0&&t.y<o.length&&t.y>=0&&(o[t.y][t.x]=r,t.y<o.length-1&&e({x:t.x,y:t.y+1},n,r),t.y>0&&e({x:t.x,y:t.y-1},n,r),t.x<o[0].length-1&&e({x:t.x+1,y:t.y},n,r),t.x>0&&e({x:t.x-1,y:t.y},n,r))}(t,n,r),o},copyTiles:i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={create:function(e,t,n,r,i,o,u){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===u&&(u="#ffffff");var a=[];return{width:n,height:r,texture:o,colour:u,frame:0,setFrames:function(e){a=e},addFrame:function(e){a.push(e)},get frames(){return a},get x(){return e},set x(t){e=t},get y(){return t},set y(e){t=e},get rotation(){return i},set rotation(e){i=e>=360?360-e:e}}}}},function(e,t,n){"use strict";function r(e,t){var n=e,o=t,u=function(){return Math.sqrt(n*n+o*o)},a=function(e){n*=e,o*=e},l=function(){var e=u();n/=e,o/=e};return{add:function(e){n+=e.x,o+=e.y},addScalar:function(e){n+=e,o+=e},clone:i,divide:function(e){n/=e.x,o/=e.y},divideScalar:function(e){n/=e,o/=e},dot:function(e){return n*e.x+o*e.y},getLength:u,getOpposite:function(e){return r(-e.x,-e.y)},getPerp:function(){return r(-o,n)},isEqualTo:function(e){return n==e.x&&o==e.y},multiply:function(e){n*=e.x,o*=e.y},multiplyScalar:a,normalise:l,setLength:function(e){l(),a(e)},subtract:function(e){n-=e.x,o-=e.y},subtractScalar:function(e){n-=e,o-=e},set x(e){n=e},get x(){return n},set y(e){o=e},get y(){return o}}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return r(e.x,e.y)};t.default={clone:i,create:r,fromDegrees:function(e){var t=e*(Math.PI/180);return r(Math.cos(t),Math.sin(t))}}}])}));