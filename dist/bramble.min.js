!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Bramble=t():e.Bramble=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/js/",n(n.s=1)}([function(e,t){function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function r(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=[],o=0;o<t;o++){for(var i=[],u=0;u<e;u++)i.push(n);r.push(i)}return r}function u(e){return e.map((function(e){return e.slice()}))}var a={pos:{x:0,y:0},visible:!0,divisions:4,tileWidth:8,tileHeight:8,scale:1};e.exports={create:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a;n=r(r({},a),n);var o=i(e,t,0),u={x:n.pos.x,y:n.pos.y},c=n.visible,l=n.divisions,f=n.tileWidth,s=n.tileHeight,d=n.tileWidth,h=n.scale;return{divisions:l,pos:u,tileHeight:s,tiles:o,tileWidth:f,visible:c,width:e,height:t,tileSize:d,scale:h}},fill:function(e,t,n,r){var o=u(e);return function e(t,n,r){n!==r&&o[t.y][t.x]===n&&t.x<o[t.y].length&&t.x>=0&&t.y<o.length&&t.y>=0&&(o[t.y][t.x]=r,t.y<o.length-1&&e({x:t.x,y:t.y+1},n,r),t.y>0&&e({x:t.x,y:t.y-1},n,r),t.x<o[0].length-1&&e({x:t.x+1,y:t.y},n,r),t.x>0&&e({x:t.x-1,y:t.y},n,r))}(t,n,r),o},copyTiles:u}},function(e,t,n){"use strict";n.r(t),n.d(t,"assets",(function(){return s})),n.d(t,"game",(function(){return L})),n.d(t,"grid",(function(){return B.a})),n.d(t,"graphics",(function(){return O})),n.d(t,"keyboard",(function(){return D})),n.d(t,"mouse",(function(){return C})),n.d(t,"music",(function(){return I})),n.d(t,"sfx",(function(){return R})),n.d(t,"sprite",(function(){return q})),n.d(t,"textbox",(function(){return z})),n.d(t,"sound",(function(){return i})),n.d(t,"canvas",(function(){return S})),n.d(t,"vec2",(function(){return Y}));var r={create:function(e,t,n,r){return{name:e,type:t,image:n,tiles:r}}},o=new AudioContext;o.createOscillator(),o.createGain();var i={decode:function(e){return new Promise((function(t,n){o.decodeAudioData(e).then((function(e){return t(e)})).catch((function(e){return n(e)}))}))},play:function(e){var t=o.createBufferSource();t.buffer=e,t.connect(o.destination),t.start()}};function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";return new Promise((function(n,r){var o=new XMLHttpRequest;o.responseType=t,o.addEventListener("load",(function(e){switch(t){case"text":n(e.target.responseText);break;case"json":n(e.target.response);break;default:console.error("invalid type provided to load: ".concat(t," is unknown"))}})),o.addEventListener("error",(function(e){r(e)})),o.open("GET",e,!0),o.send()}))}function a(e){return u(e,"json")}function c(e){return new Promise((function(t,n){var r=new Image;r.addEventListener("load",(function(e){t(r)})),r.addEventListener("error",(function(e){n(e)})),r.src=e}))}function l(e){return new Promise((function(t,n){window.fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){return i.decode(e)})).then((function(e){return t(e)})).catch((function(e){return n(e)}))}))}function f(e){var t=null;return a(e).then((function(e){return c((t=e).path)})).then((function(e){return r.create(t.name,t.type,e,t.tiles)})).catch((function(e){console.error(e)}))}var s={loadText:function(e){return u(e,"text")},loadJson:a,loadImage:c,loadAllText:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Promise.all(e.map((function(e){return u(e,"text")})))},loadAllImages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Promise.all(e.map((function(e){return c(e)})))},loadSound:l,loadAllSounds:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Promise.all(e.map((function(e){return l(e)})))},loadTerrain:f,loadAllTerrain:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Promise.all(e.map((function(e){return f(e)})))}};var d={toRadians:function(e){return e*(Math.PI/180)},toDegrees:function(e){return e*(180/Math.PI)}};function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var v=null;var g={fill:{color:"#ffffff",opacity:1},line:{width:2,color:"#000000",opacity:1}};function p(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:g;void 0!==o.fill&&(v.fillStyle=o.fill.color,v.fillRect(e,t,n,r)),void 0!==o.line&&(v.strokeStyle=o.line.color,v.lineWidth=o.line.width,v.strokeRect(e,t,n,r))}var y={width:2,color:"#000000"};var b={fill:{color:"#000000",opacity:1},line:{color:"#ffffff",opacity:1,width:2}};function m(e,t,n,r,o){v.drawImage(o,e,t,n,r)}function x(e,t,n,r,o,i,u,a,c){v.drawImage(c,o,i,u,a,e,t,n,r)}var w={shadowColor:"#000000",shadowBlur:6,shadowOffsetX:4,shadowOffsetY:4};var O={circle:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b;void 0!==r.fill&&(v.fillStyle=r.fill.color),v.beginPath(),v.strokeStyle=r.line.color,v.lineWidth=r.line.width,v.arc(e,t,n,0,2*Math.PI),v.closePath(),void 0!==r.fill&&v.fill(),v.stroke()},clear:function(e){p(0,0,v.canvas.width,v.canvas.height,{fill:{color:e}})},image:m,line:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y;v.strokeStyle=n.color,v.lineWidth=n.width,v.beginPath(),v.moveTo(e.x,e.y),v.lineTo(t.x,t.y),v.stroke()},rect:p,getContext:function(){return v},setContext:function(e){v=e},sprite:function(e){var t=e.width/2,n=e.height/2;v.save(),v.translate(e.x+t,e.y+n),v.rotate(d.toRadians(e.rotation)),e.frames.length>1?x(-t,-n,e.width,e.height,e.frames[e.frame].x,e.frames[e.frame].y,e.frames[e.frame].width,e.frames[e.frame].height,e.texture):m(-t,-n,e.width,e.height,e.texture),v.restore()},square:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g;p(e,t,n,n,r)},subImage:x,text:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#000000",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"16pt sans-serif";v.fillStyle=r,v.font=o,v.textAlign="left",v.textBaseline="top",v.fillText(n,e,t)},textbox:function(e){v.fillStyle="#ffffff",v.font="16pt sans-serif",v.textAlign="left",v.textBaseline="top",v.measureText(e.text).width>e.width&&(e.text=e.text.substr(0,10)+"\n"+e.text.substr(10)),v.fillText(e.text,e.x,e.y)},tiles:function(e,t,n,r,o,i,u){for(var a=1,c=2,l=4,f=8,s=16,d=32,v=64,g=128,p=function(i){for(var u=function(u){if(0===n[i][u])return"continue";var h=i>0?n[i-1][u-1]:0,p=i>0?n[i-1][u]:0,y=i>0?n[i-1][u+1]:0,b=n[i][u-1],m=n[i][u],w=n[i][u+1],O=i<n.length-1?n[i+1][u-1]:0,j=i<n.length-1?n[i+1][u]:0,P=i<n.length-1?n[i+1][u+1]:0,S=a*(m===p&&m===b&&m===h?1:0)+c*(m===p?1:0)+l*(m===p&&m===w&&m===y?1:0)+f*(m===w?1:0)+s*(m===j&&m===w&&m===P?1:0)+d*(m===j?1:0)+v*(m===j&&m===b&&m===O?1:0)+g*(m===b?1:0),T=r.filter((function(e){return e.type===n[i][u]}))[0];if(!T)return console.error("Sheet ".concat(n[i][u]," not found!")),{v:{v:void 0}};var k=T.tiles.filter((function(e){return e.type===S})),E=k[Math.floor(Math.random()*k.length)];E?function(e,t,n,r,o,i,u,a,c,l){x(e+a*(r*c),t+a*(o*l),a*c,a*l,c*i,l*u,c,l,n)}(e,t,T.image,u,i,E.position.x,E.position.y,o,E.size.width,E.size.height):console.log("Tile not defined ".concat(S))},p=0;p<n[i].length;p++){var y=u(p);if("continue"!==y&&"object"===h(y))return y.v}},y=0;y<n.length;y++){var b=p(y);if("object"===h(b))return b.v}},shadow:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w;v.save(),v.shadowColor=t.shadowColor,v.shadowBlur=t.shadowBlur,v.shadowOffsetX=t.shadowOffsetX,v.shadowOffsetY=t.shadowOffsetY,e(),v.restore()},dodge:function(e){v.save(),v.globalCompositeOperation="color-dodge",e(),v.restore()},overlay:function(e){v.save(),v.globalCompositeOperation="overlay",e(),v.restore()},transparency:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.25;v.save(),v.globalAlpha=t,e(),v.restore()}},j=document.createElement("canvas");j.id="bramble-game";var P=j.getContext("2d");var S={element:j,setSize:function(e,t){j.width=e,j.height=t},attachTo:function(e){e.appendChild(j),O.setContext(P)},setSmoothing:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];P.imageSmoothingEnabled=e},disableContextMenu:function(){j.addEventListener("contextmenu",(function(e){e.preventDefault()}))}};function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var M={create:function(e){var t=function(){return{x:0,y:0,left:n(),wheel:r(),right:n()}},n=function(){return{pressed:!1,justPressed:!1,released:!1,justReleased:!1}},r=function(){return k(k({},n()),{},{moved:!1})},o=(t(),t());console.log(o);var i=function(t){var n=function(t,n){var r=e.getBoundingClientRect();return{x:t.clientX-r.left,y:t.clientY-r.top}}(t);o.x=n.x,o.y=n.y},u=function(e){switch(e.which){case 1:console.log("left down"),o.left.pressed=!0;break;case 2:o.middle.pressed=!0;break;case 3:o.right.pressed=!0}},a=function(e){switch(e.which){case 1:o.left.pressed=!1;break;case 2:o.middle.pressed=!1;break;case 3:o.right.pressed=!1}},c=function(e){o.wheel.moved=0!==e.delta,!1!==o.wheel.moved&&(o.wheel.direction=e.deltaY<0?"up":"down")};return{mouse:o,start:function(){e.addEventListener("mousemove",i),e.addEventListener("mousedown",u),e.addEventListener("mouseup",a),e.addEventListener("wheel",c),o.x=e.width/2,o.y=e.height/2},update:function(){var e;o.wheel.moved=!1,e=o,Object.assign({},e)}}}};var C={create:function(e){var t=M.create(e);return{start:function(){t.start()},update:function(){t.update()},mouse:t.state}}},D={create:function(){console.log("keyboard input stub")}},L={create:function(){var e="#000000",t=null,n=null,r=C.create(S.element),o=function o(){t&&t(1/60),n&&(O.clear(e),n()),r.update(),window.requestAnimationFrame(o)};return{setSize:S.setSize,setUpdate:function(e){t=e},setRender:function(e){n=e},setBackgroundColor:function(t){e=t},attachTo:S.attachTo,disableContextMenu:S.disableContextMenu,setSmoothing:S.setSmoothing,start:function(){r.start(),window.requestAnimationFrame(o)}}}},A=n(0),B=n.n(A),I={},R={};function W(e,t){for(var n in t){(i=t[n]).configurable=i.enumerable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,n,i)}if(Object.getOwnPropertySymbols)for(var r=Object.getOwnPropertySymbols(t),o=0;o<r.length;o++){var i,u=r[o];(i=t[u]).configurable=i.enumerable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,u,i)}return e}var q={create:function(){var e,t,n,r,o,i,u,a,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"#ffffff",g=[];return u={x:c,y:l,width:f,height:s,rotation:d,texture:h,color:v,frame:0,setFrames:function(e){g=e},addFrame:function(e){g.push(e)},get frames(){return g}},(a={})[e="x"]=a[e]||{},a[e].get=function(){return c},a[t="x"]=a[t]||{},a[t].set=function(e){c=e},a[n="y"]=a[n]||{},a[n].get=function(){return l},a[r="y"]=a[r]||{},a[r].set=function(e){l=e},a[o="rotation"]=a[o]||{},a[o].get=function(){return d},a[i="rotation"]=a[i]||{},a[i].set=function(e){d=e>=360?360-e:e},W(u,a),u}};var z={create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return{x:e,y:t,width:n,height:r,text:o}}};function _(e,t){var n=e,r=t,o=function(){return Math.sqrt(n*n+r*r)},i=function(e){n*=e,r*=e},u=function(){var e=o();n/=e,r/=e};return{add:function(e){n+=e.x,r+=e.y},addScalar:function(e){n+=e,r+=e},clone:X,divide:function(e){n/=e.x,r/=e.y},divideScalar:function(e){n/=e,r/=e},dot:function(e){return n*e.x+r*e.y},getLength:o,getOpposite:function(e){return _(-e.x,-e.y)},getPerp:function(){return _(-r,n)},isEqualTo:function(e){return n==e.x&&r==e.y},multiply:function(e){n*=e.x,r*=e.y},multiplyScalar:i,normalise:u,setLength:function(e){u(),i(e)},subtract:function(e){n-=e.x,r-=e.y},subtractScalar:function(e){n-=e,r-=e},set x(e){n=e},get x(){return n},set y(e){r=e},get y(){return r}}}var X=function(e){return _(e.x,e.y)},Y={clone:X,create:_,fromDegrees:function(e){var t=e*(Math.PI/180);return _(Math.cos(t),Math.sin(t))}}}])}));